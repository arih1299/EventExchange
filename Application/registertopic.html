<!DOCTYPE html>
<!--This html renders the form to capture the registration of topics by agencies-->
<html lang="en">

<head>
  <title>Prototype Demo - Register Topic</title>
  <meta http-equiv="X-UA-Compatible" content="IE=edge;" />
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <!-- Load Solace Web Messaging API for JavaScript -->
  <!-- <script src="lib/solclient-debug.js"></script> -->

  <!-- load js to run the ui for this page-->
  <!-- <script src="processtopicreg.js"></script> -->

  <!-- Load js to retrieve the ACL via SEMP API REST call -->
  <script src="AccessListCall.js"></script>

  <!-- Solace cloud login details-->
  <script src="config/config.js" type="text/javascript"></script>

  <!-- Load CSS-->
  <link rel="stylesheet" type="text/css" href="css/pure.css">
  </link>
  <link rel="stylesheet" type="text/css" href="css/samples.css">
  </link>
  <link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/jointjs/2.1.0/joint.css" />
  <!-- Load W3.CSS-->
  <link rel="stylesheet" href="https://www.w3schools.com/w3css/4/w3.css">
  <!-- Latest compiled and minified CSS -->
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css">
  <!-- jQuery library -->
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.0/jquery.min.js"></script>
  <!-- Popper JS -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js"></script>
  <!-- Latest compiled JavaScript -->
  <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js"></script>
  <!-- Load sweetalert css to be used in login.js-->
  <script src="https://unpkg.com/sweetalert/dist/sweetalert.min.js"></script>

  <!-- run script to initalize solclient and listners for submit-->
  <script type="text/javascript">
    var publisher = null;
    window.onload = function () {
        // Initialize factory with the most recent API defaults
        // var factoryProps = new solace.SolclientFactoryProperties();
        // factoryProps.profile = solace.SolclientFactoryProfiles.version10;
        // solace.SolclientFactory.init(factoryProps);

        // enable logging to JavaScript console at WARN level
        // NOTICE: works only with "solclientjs-debug.js"
        // solace.SolclientFactory.setLogLevel(solace.LogLevel.WARN);

        // create the publisher, specifying name of the subscription topic
        // publisher = new RegPublisher('SOLACE_TOPICREG');
        // Below function Executes on click of submit button.
        $("#submit").click(function () {
          console.debug("Caught send button event");
          // var a = document.forms["topicreg"]["aname"].value
          var t = document.forms["topicreg"]["topic"].value
          // var d = document.forms["topicreg"]["desc"].value
          if (t === "") {
            // syntax from sweetalert.js library to create alrets
            // will output an error alert box with the title and text as the output
            swal({
              title: "Missing Topic! ",
              text: "Please input topic!",
              icon: "error"
            })
          } else {
            var checkedValue = "";
            var inputElements = document.getElementsByClassName('w3-check');
            for (var i = 0; i < inputElements.length; ++i) {
              if (inputElements[i].checked) {
                console.log(inputElements[i].value)
                if (inputElements[i].value == "all") {
                  // if published topic is open to all agencies to subscribe it will create exceptions in all agencies ACl
                  AccessListCall("LTA", "POST", t);
                  console.log('it went in')
                  break;
                } else {
                  checkedValue += inputElements[i].value + ","
                }
              }
            }
            console.log(checkedValue)
            if (checkedValue !== "") {
              // creates subscription exceptions in the ACL of the releveant checked agencies
              AccessListCall("LTA", "POST", t, checkedValue);
            }
            // publisher.publish()
            // publisher.disconnect()
            // syntax from sweetalert.js library to create alrets
            // will output an success alert box with the title and text as the output
            swal({
              title: "Thanks for registering! ",
              text: "Your registration will be confirmed in 3 working days",
              icon: "success"
            })
            // reinitalize form adter submission
            document.getElementById("topicreg").reset();
            toggleSelection2();
            toggleSelection();
          }
        });
        //function disables all other checkboxes when the all check box is clicked
        function toggleSelection() {
          var a = document.getElementById("all");
          var b = document.getElementById("moh");
          var c = document.getElementById("lta");
          var d = document.getElementById("nea");
          if (a.checked) {
            b.disabled = true;
            c.disabled = true;
            d.disabled = true;
          } else {
            b.disabled = false;
            c.disabled = false;
            d.disabled = false;
          }
        }
        //function disables the all check box if the other checkboxes are clicked
        function toggleSelection2() {
          var a = document.getElementById("all");
          var b = document.getElementById("moh");
          var c = document.getElementById("lta");
          var d = document.getElementById("nea");
          if (b.checked || c.checked || d.checked) {
            a.disabled = true;
          } else {
            a.disabled = false;
          }
        }
    }
  </script>
</head>

<body>
  <form name='topicreg' id='topicreg' class="w3-panel was-validated">
    <!-- <div class="form-group">
      <label class="w3-text-teal" for="aname">Agency Name:</label>
      <input type="text" class="form-control w3-input w3-border w3-light-grey w3-hover-shadow" id="aname"
        placeholder="Enter the publishing Agency Name" name="aname" required></input>
      <div class="valid-feedback">Valid.</div>
      <div class="invalid-feedback">Please fill out this field.</div>
    </div> -->
    <div class="form-group">
      <label class="w3-text-teal" for="topic">Topic:</label>
      <input type="text" class="form-control w3-input w3-border w3-light-grey w3-hover-shadow" id=" topic"
        placeholder="Enter Topic to be Published" name="topic" required></input>
      <div class="valid-feedback">Valid.</div>
      <div class="invalid-feedback">Please fill out this field.</div>
    </div>
    <!-- <div class="form-group">
      <label class="w3-text-teal" for="desc">Description:</label>
      <input type="text" class="form-control w3-input w3-border w3-light-grey w3-hover-shadow" id=" desc"
        placeholder="Give a brief description about the topic" name="desc" required>
      <div class="valid-feedback">Valid.</div>
      <div class="invalid-feedback">Please fill out this field.</div>
    </div> -->
    <div class="form-group">
      <label class="w3-text-teal" for="desc">Which Agency Can Access this topic?:</label>
      <input class="w3-check" type="checkbox" checked="checked" id='all' name="agency" value="all"
        onClick="toggleSelection()">
      <label>All Agencies</label>
      <input class="w3-check" type="checkbox" id='moh' name="agency" value="MOH" onClick="toggleSelection2()" disabled>
      <label>MOH</label>
      <input class="w3-check" type="checkbox" id='lta' name="agency" value="LTA" onClick="toggleSelection2()" disabled>
      <label>LTA</label>
      <input class="w3-check" type="checkbox" id='nea' name="agency" value="NEA" onClick="toggleSelection2()" disabled>
      <label>NEA</label>
    </div>
    <button type="button" class="btn btn-primary" id='submit'>Submit</button>
  </form>
</body>

</html>