<!DOCTYPE html>

<html lang="en">

  <head>
    <title>Prototype Demo</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge;" />
    <meta charset="utf-8"/>

    <link rel="stylesheet" type="text/css" href="css/pure.css"></link>
    <link rel="stylesheet" type="text/css" href="css/samples.css"></link>
    
    <!-- Load Solace Web Messaging API for JavaScript -->
    <script src="lib/solclient-debug.js"></script>

    <!-- Load the Confirmed Delivery tutorial -->
    <script src="process.js"></script>
    <script src="lib/go.js"></script>
    <script src="diagram.js"></script>
    <script src="config/config.js" type="text/javascript"></script>

    <!-- Execute the Confirmed Delivery tutorial -->
    <script>
      var producer = null;
      window.onload = function () {
        init();
        // Initialize factory with the most recent API defaults
        var factoryProps = new solace.SolclientFactoryProperties();
        factoryProps.profile = solace.SolclientFactoryProfiles.version10;
        solace.SolclientFactory.init(factoryProps);

        // enable logging to JavaScript console at WARN level
        // NOTICE: works only with "solclientjs-debug.js"
        solace.SolclientFactory.setLogLevel(solace.LogLevel.WARN);

        // create the producer, specifying name of the subscription topic
        producer = new QueueProducer('SOLACE_QUEUE');
        // assign buttons to the producer functions
        document.getElementById("pubconnect").addEventListener("click", producer.connect);
        document.getElementById("pubdisconnect").addEventListener("click", producer.disconnect);
        document.getElementById("publish").addEventListener("click", producer.sendMessages);

        subscriber = new QueueConsumer('SOLACE_QUEUE', 'subscribelog');
        subscriber2 = new TopicSubscriber('subscribelog2');
        document.getElementById("subconnect").addEventListener("click", subscriber.connect);
        document.getElementById("subdisconnect").addEventListener("click", subscriber.disconnect);
        document.getElementById("startconsume").addEventListener("click", subscriber.startConsume);
        document.getElementById("stopconsume").addEventListener("click", subscriber.stopConsume);
        document.getElementById("subconnect2").addEventListener("click", subscriber2.connect);
        document.getElementById("subdisconnect2").addEventListener("click", subscriber2.disconnect);
        document.getElementById("subscribe").addEventListener("click", subscriber2.subscribe);
        document.getElementById("unsubscribe").addEventListener("click", subscriber2.unsubscribe);
      };
      function iframeloaded(){
        if (platform) {
          platform.connectToSolace();
        }
      };
      function preview(){
        var reader = new FileReader();
        var preview = document.getElementById('imgpreview');
        var file = document.getElementById('fileimg').files[0];
        reader.onloadend = function(){
          preview.src = reader.result;
        }
        if (file){
          reader.readAsDataURL(file);

        }else{
          preview.src="";
        }
      }
      preview();
    </script>
  </head>

  <body>
  <!-- used to prompt selection of client certificate -->
    <iframe id="iframe" src="" onload="iframeloaded()" hidden></iframe>

    <div class="banner">
      <div class="banner-interior">
        <span class="logo">
          <img src="image/solace.png"/>
        </span>
        <div class="banner-heading">
          Demo (Iter 1)
        </div>
      </div>
    </div>

    <div class="doc-body">
      <h2>Message flow in a Smart City using Solace</h2>
      <form class="pure-form pure-form-aligned">
        <fieldset>

          <div class="pure-control-group">
              <label for="content">Message Content <br>(eg. Fire at Holland)</label>
              <input id="content" type="text" placeholder="Insert Text">
          </div>

          <div class="pure-control-group">
            <label for="publishtopic">What Topic to Publish Message to?g</label>
            <input id="publishtopic" type="text" placeholder="Insert Topic" value="tutorial/queue/message">
          </div>
          
          <div class="pure-control-group">
            <label for="fileimg">Image Upload <br> (e.g. Picture of accident)</label>
            <input id="fileimg" type="file" onchange="preview()"><br>
            <img src="image/blank.png" height="200" alt="Image Preview" id="imgpreview">
          </div>

        </fieldset>
        <p>
          <button type="button" class="pure-button pure-button-primary" id="pubconnect">Connect</button>
          <button type="button" class="pure-button button-error" id="pubdisconnect">Disconnect</button>
        </p>
        <p>
          <button type="button" class="pure-button pure-button-primary" id="publish">Send Message Content</button>
        </p>
        <p>
          <div class="publishlog" id="publishlog" contentEditable="true"></div>
        </p>

        <div id="sample">
          <div id="myDiagramDiv" style="background-color: whitesmoke; border: solid 1px black; width: 75%; height: 300px"></div>
        </div>

        <div class="grid-container">
          <div class="grid-item">
            <p>
              <button type="button" class="pure-button pure-button-primary" id="subconnect">Connect</button>
              <button type="button" class="pure-button button-error" id="subdisconnect">Disconnect</button>
            </p>
            <p>
              <button type="button" class="pure-button pure-button-primary" id="startconsume">Consume messages </button>
              <button type="button" class="pure-button button-error" id="stopconsume">Stop consuming</button>
            </p>
          </div>
          <div class="grid-item">
              <p>
                <button type="button" class="pure-button pure-button-primary" id="subconnect2">Connect</button>
                <button type="button" class="pure-button button-error" id="subdisconnect2">Disconnect</button>
              </p>
              <p>
                <button type="button" class="pure-button pure-button-primary" id="subscribe">Subscribe </button>
                <button type="button" class="pure-button button-error" id="unsubscribe">Unsubscribe</button>
              </p>
              <div class="pure-control-group">
                <label for="topicname">Topic Name: </label>
                <input id="topicname" type="text" placeholder="Insert Topic">
              </div>
              
            </div>
            <div class="grid-item">
                <p>
                  <div class="subscribelog" id="subscribelog" contentEditable="true"></div>
                </p>
            </div>
            <div class="grid-item">
                <p>
                  <div class="subscribelog" id="subscribelog2" contentEditable="true"></div>
                </p>
            </div>
        </div>
        <div class="grid-container">
              <table border="1", width="400px" id='table2'>
                  <tr>
                    <th>Image</th>
                  </tr>
              </table>
              <table border="1", width="400px", id='table1'>
                  <tr>
                    <th>Message</th>
                  </tr>
              <table>
        </div>
        
      </form>
    </div>
  </body>
  
</html>

