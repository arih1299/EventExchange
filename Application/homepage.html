<!DOCTYPE html>

<html lang="en">

<head>
    <title>Prototype Demo (Homepage)</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge;" />
    <meta charset="utf-8" />
    <link rel="stylesheet" type="text/css" href="css/pure.css">
    </link>
    <link rel="stylesheet" type="text/css" href="css/samples.css">
    </link>

    <!-- Load Solace Web Messaging API for JavaScript -->
    <script src="lib/solclient-debug.js"></script>
    <script src="Centralpubsub.js"></script>
    <script src="EventMsg.js"></script>
    <script src="microsoftanalyse.js"></script>
    <script src="ui.js"></script>
    <script src="config/config.js" type="text/javascript"></script>
    <script src="https://canvasjs.com/assets/script/canvasjs.min.js"></script>
    <script src="https://requirejs.org/docs/release/2.3.6/minified/require.js"></script>
    </script>
    <link rel="stylesheet" href="https://www.w3schools.com/w3css/4/w3.css"></link>
    <script>
        var producer = null;
        var yTemp = 0;
        var yRain = 0;
        var yImg = 0;
        var yTaxi = 0;


        var Tempps = []; // dataPoints
        var Rainps = [];
        var Imgps = [];
        var Taxips = [];

        var xVal = 0;
        var updateInterval = 1000;
        var dataLength = 20; // number of dataPoints visible at any point
        var chart;

        var updateChart = function (count) {

            count = count || 1;

            for (var j = 0; j < count; j++) {
                Tempps.push({
                    x: xVal,
                    y: yTemp
                });
                Rainps.push({
                    x: xVal,
                    y: yRain
                });
                Imgps.push({
                    x: xVal,
                    y: yImg
                });
                Taxips.push({
                    x: xVal,
                    y: yTaxi
                });
                xVal++;
                yRain = 0;
                yTemp = 0;
                yImg = 0;
                yTaxi = 0;
            }

            if (Tempps.length > dataLength) {
                Tempps.shift();
                Rainps.shift();
                Imgps.shift();
                Taxips.shift();
            }

            chart.render();
        };
        window.onload = function () {
            chart = new CanvasJS.Chart("chartContainer", {
                title: {
                    text: "Data Flow"
                },
                axisY: {
                    includeZero: false,
                    title: "msgs per sec."
                },
                axisX: {
                    title: "Time elapsed"
                },
                data: [{
                    type: "line",
                    dataPoints: Tempps,
                    showInLegend: true,
                    legendText: "Temperature"
                }, {
                    type: "line",
                    dataPoints: Rainps,
                    showInLegend: true,
                    legendText: "Rain"
                }, {
                    type: "line",
                    dataPoints: Imgps,
                    showInLegend: true,
                    legendText: "Traffic Image"
                }, {
                    type: "line",
                    dataPoints: Taxips,
                    showInLegend: true,
                    legendText: "Taxi"
                }]
            });

            //setInterval(function(){updateChart()}, updateInterval);

            // Initialize factory with the most recent API defaults
            var factoryProps = new solace.SolclientFactoryProperties();
            factoryProps.profile = solace.SolclientFactoryProfiles.version10;
            solace.SolclientFactory.init(factoryProps);

            // enable logging to JavaScript console at WARN level
            // NOTICE: works only with "solclientjs-debug.js"
            solace.SolclientFactory.setLogLevel(solace.LogLevel.WARN);

            central = new PubSub({queueName : 'SOLACE_ALL', logname : 'subscribelog', tableName : 'table'});
            document.getElementById("subconnect").addEventListener("click", central.connect);
            document.getElementById("subdisconnect").addEventListener("click", central.disconnect);
            document.getElementById("startconsume").addEventListener("click", central.startConsume);
            document.getElementById("stopconsume").addEventListener("click", central.stopConsume);
            updateChart(dataLength);
        };
    </script>
</head>

<body>

    <div class="banner">
        <div class="banner-interior">
            <span class="logo">
                <img src="image/solace.png" />
            </span>
            <div class="banner-heading">
                Demo (Iter 1)
            </div>
        </div>
    </div>
    <div class="w3-bar w3-black">
        <button class="w3-bar-item w3-button tablink w3-red" onclick="openStuff(event, 'Published')">Published
            Topics</button>
        <button class="w3-bar-item w3-button tablink" onclick="openStuff(event, 'AvilTopics')">Topics Available</button>
        <button class="w3-bar-item w3-button tablink" onclick="openStuff(event, 'stat')">Current Message
            Statistics</button>
        <button class="w3-bar-item w3-button tablink" onclick="openStuff(event, 'RegTopic')">Register a topic</button>
        <button class="w3-bar-item w3-button tablink" onclick="openStuff(event, 'mapped')">Analytics and Mapping
            Example</button>
    </div>

    <div id="Published" class="w3-container w3-border pubsub">
        <br><br>
        <table class="w3-table-all w3-hoverable w3-card-4" , id='publishTopic'>
            <tr class='w3-teal'>
                <th>Published Topics</th>
                <th>Description</th>
            </tr>
            <tr>
                <td>NEA/1/temp_data/raw</td>
                <td>Provides a stream of raw temperature data from various weather sensors in singapore<br>
                    Example Message Content :"id": "S109", "lat": "1.3764", "long": "103.8492", "value": "31.1",
                    "timestamp":
                    "2019-05-29T16:40:00+08:00"
                </td>
            </tr>
            <tr>
                <td>NEA/1/rain_data/raw</td>
                <td>Provides a stream of raw rain data from various weather sensors in singapore<br>
                    Example Message Content :"id": "S109", "lat": "1.3764", "long": "103.8492", "value": "1",
                    "timestamp":
                    "2019-05-29T16:40:00+08:00"
                </td>
            </tr>
            <tr>
                <td>NEA/1/temp_data/change</td>
                <td>Streams a message indicating the location of a temperature change of more than 0.5 degrees celsius
                    based on analysis of raw data<br>
                </td>
            </tr>
            <tr>
                <td>NEA/1/rain_data/start</td>
                <td>Streams a message indicating the location of where rain has started based on analysis of raw data
                </td>
            </tr>
            <tr>
                <td>NEA/1/rain_data/stop</td>
                <td>Streams a message indicating the location of where rain has stopped based on analysis of raw data
                </td>
            </tr>
        </table>
    </div>

    <div id="AvilTopics" class="w3-container w3-border pubsub" style="display:none">
        <br><br>
        <table class="w3-table-all w3-hoverable w3-card-4" , id='avilTopic'>
            <tr class='w3-teal'>
                <th>Available Topics</th>
                <th>Description</th>
            </tr>
            <tr>
                <td>LTA/1/img_data/raw</td>
                <td>Provides a stream of raw images of expressways in singapore<br>
                </td>
            </tr>
            <tr>
                <td>LTA/1/taxi_data/raw</td>
                <td>Provides a stream of raw location data on the available taxis in singapre<br>
                </td>
            </tr>
        </table>
    </div>
    <div id="stat" class="w3-container w3-border pubsub" style="display:none">
        <br><br>
        <form></form>
        <div class="w3-bar">
            <p>
                <button type="button" class="pure-button pure-button-primary" id="subconnect">Connect</button>
                <button type="button" class="pure-button button-error" id="subdisconnect">Disconnect</button>
                <button type="button" class="pure-button pure-button-primary" id="startconsume">Consume Messages
                </button>
                <button type="button" class="pure-button button-error" id="stopconsume">Stop Consuming</button>
            </p>
        </div>
        <div id="chartContainer" style="height: 300px; width: 100%;"></div>
        <div class="subscribelog" id="subscribelog" contentEditable="true" style="visibility: hidden"></div>
        <table id='table' style="visibility: hidden">
            <tr>
                <th>Image</th>
            </tr>
        </table>
        <input type="hidden" id="nene" value="NEA/1/temp_data/change"></input>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.1.1/jquery.js"></script>
    </div>

    <div id="RegTopic" class="w3-container w3-border pubsub" style="display:none">
        <iframe src="registertopic.html" height="500" width="100%"></iframe>
    </div>

    <div id="mapped" class="w3-container w3-border pubsub" style="display:none">
        <iframe src="map.html" height="500" width="100%"></iframe>
    </div>
    
</body>

</html>